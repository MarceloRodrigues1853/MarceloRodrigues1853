name: Atualizar README autom√°tico

on:
  schedule:
    # Executa todos os dias √†s 00h UTC
    - cron: "0 0 * * *"
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Baixa o c√≥digo atual do reposit√≥rio
      - name: Checkout do reposit√≥rio
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Configura Node.js (necess√°rio para rodar script JS de formata√ß√£o)
      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3Ô∏è‚É£ Instala depend√™ncias (se houver)
      - name: Instalar depend√™ncias
        run: npm install

      # 4Ô∏è‚É£ Gera estat√≠sticas e substitui blocos
      - name: Gerar estat√≠sticas e atualizar README
        run: |
          echo "üîÑ Buscando reposit√≥rios recentes..."
          # Aqui voc√™ pode rodar a action de stats, por exemplo:
          npx profile-readme-stats --max-repos 5 > repos_temp.txt

          echo "üîÑ Inserindo lista no README..."
          # Remove qualquer bloco entre os marcadores e substitui pela lista final
          sed -i "/{{ REPOSITORIES_TEMPLATE_START/,/{{ REPOSITORIES_TEMPLATE_END }}/c\$(cat repos_temp.txt)" README.md
          

          echo "‚úÖ Lista de reposit√≥rios atualizada sem placeholders"

      # 5Ô∏è‚É£ Gera commit e envia para o GitHub
      - name: Commit e Push se houver mudan√ßas
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          if [[ -n "$(git status --porcelain)" ]]; then
            git add README.md
            git commit -m "Atualizando README autom√°tico"
            git push
          else
            echo "Nenhuma altera√ß√£o detectada."
          fi
